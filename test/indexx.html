<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Form Builder with Dashboard</title>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.1/themes/base/jquery-ui.css">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f7fa;
        }
        .header {
            background-color: #4b6cb7;
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .logo {
            font-size: 24px;
            font-weight: bold;
        }
        .main-container {
            display: flex;
            height: calc(100vh - 60px);
        }
        .toolbox {
            width: 250px;
            background-color: white;
            padding: 15px;
            border-right: 1px solid #e0e0e0;
            overflow-y: auto;
        }
        .form-builder {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background-color: #f9fafc;
        }
        .form-preview {
            width: 350px;
            background-color: white;
            padding: 20px;
            border-left: 1px solid #e0e0e0;
            overflow-y: auto;
        }
        .form-element {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 12px;
            margin-bottom: 10px;
            cursor: move;
            transition: all 0.2s;
        }
        .form-element:hover {
            background-color: #e9ecef;
            border-color: #ced4da;
        }
        .form-element i {
            margin-right: 8px;
            color: #6c757d;
        }
        .droppable-area {
            min-height: 300px;
            background-color: white;
            border: 2px dashed #adb5bd;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        .form-field {
            background-color: white;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 15px;
            position: relative;
        }
        .form-field:hover {
            box-shadow: 0 0 0 2px #4b6cb7;
        }
        .form-field label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #495057;
        }
        .form-field input, 
        .form-field select, 
        .form-field textarea {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 14px;
        }
        .field-actions {
            position: absolute;
            top: 5px;
            right: 5px;
        }
        .field-actions button {
            background: none;
            border: none;
            cursor: pointer;
            color: #6c757d;
            padding: 2px 5px;
        }
        .field-actions button:hover {
            color: #4b6cb7;
        }
        .preview-form {
            width: 100%;
        }
        .preview-form .form-field {
            box-shadow: none;
        }
        .preview-form .form-field:hover {
            box-shadow: none;
        }
        .btn {
            padding: 8px 16px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
        }
        .btn-primary {
            background-color: #4b6cb7;
            color: white;
        }
        .btn-primary:hover {
            background-color: #3a5a9c;
        }
        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }
        .btn-secondary:hover {
            background-color: #5a6268;
        }
        .btn-danger {
            background-color: #dc3545;
            color: white;
        }
        .btn-danger:hover {
            background-color: #c82333;
        }
        .section-title {
            font-size: 16px;
            font-weight: 600;
            color: #495057;
            margin: 15px 0 10px 0;
            padding-bottom: 5px;
            border-bottom: 1px solid #e0e0e0;
        }
        .dashboard {
            display: none;
            padding: 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin: 20px;
        }
        .data-card {
            background-color: #f8f9fa;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 15px;
        }
        .data-card h3 {
            margin-top: 0;
            color: #4b6cb7;
        }
        .data-item {
            margin-bottom: 5px;
            padding: 5px;
            background-color: white;
            border-radius: 3px;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 20px;
            border-radius: 5px;
            width: 80%;
            max-width: 600px;
        }
        .close {
            float: right;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">Form Builder</div>
        <div>
            <button class="btn btn-primary" id="saveForm">Save Form</button>
            <button class="btn btn-secondary" id="previewBtn">Preview</button>
            <button class="btn btn-secondary" id="viewDashboard">Dashboard</button>
            <button class="btn btn-danger" id="resetAll">Reset All</button>
        </div>
    </div>

    <div class="main-container">
        <div class="toolbox">
            <div class="section-title">Basic Fields</div>
            <div class="form-element" data-type="text">
                <i>üî†</i> Text Input
            </div>
            <div class="form-element" data-type="textarea">
                <i>üìù</i> Paragraph Text
            </div>
            <div class="form-element" data-type="email">
                <i>‚úâÔ∏è</i> Email Address
            </div>
            <div class="form-element" data-type="number">
                <i>üî¢</i> Number
            </div>
            <div class="form-element" data-type="date">
                <i>üìÖ</i> Date
            </div>
            <div class="form-element" data-type="time">
                <i>‚è∞</i> Time
            </div>

            <div class="section-title">Choice Fields</div>
            <div class="form-element" data-type="radio">
                <i>üîò</i> Multiple Choice
            </div>
            <div class="form-element" data-type="checkbox">
                <i>‚òëÔ∏è</i> Checkboxes
            </div>
            <div class="form-element" data-type="select">
                <i>üîΩ</i> Dropdown
            </div>
            <div class="section-title">Special Fields</div>
            <div class="form-element" data-type="file">
                <i>üìÅ</i> File Upload
            </div>
            <div class="form-element" data-type="rating">
                <i>‚≠ê</i> Rating
            </div>
            <div class="form-element" data-type="signature">
                <i>‚úçÔ∏è</i> Signature
            </div>
        </div>

        <div class="form-builder">
            <h2>Form Builder</h2>
            <p>Drag fields from the left panel to build your form</p>
            
            <div class="droppable-area" id="formArea">
                <!-- Form fields will be added here -->
            </div>
        </div>

        <div class="form-preview">
            <h2>Form Preview</h2>
            <div class="preview-form" id="previewArea">
                <!-- Preview will be rendered here -->
            </div>
        </div>
    </div>

    <div class="dashboard" id="dashboard">
        <h2>Form Dashboard</h2>
        <div class="section-title">Saved Forms</div>
        <div id="savedFormsList"></div>
        
        <div class="section-title">Form Submissions</div>
        <div id="submissionsList"></div>
        
        <button class="btn btn-primary" id="backToBuilder">Back to Builder</button>
        <button class="btn btn-secondary" id="exportData">Export All Data</button>
    </div>

    <div id="submissionModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Submission Details</h2>
            <div id="submissionDetails"></div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.13.1/jquery-ui.min.js"></script>
    <script>
        $(document).ready(function() {
            let fieldCount = 0;
            let formFields = [];
            let currentFormId = null;

            // Initialize data if not exists
            if (!localStorage.getItem('savedForms')) {
                localStorage.setItem('savedForms', JSON.stringify([]));
            }
            if (!localStorage.getItem('formSubmissions')) {
                localStorage.setItem('formSubmissions', JSON.stringify([]));
            }

            // Make elements draggable
            $(".form-element").draggable({
                helper: "clone",
                revert: "invalid",
                cursor: "move",
                zIndex: 1000
            });

            // Make form area droppable
            $("#formArea").droppable({
                accept: ".form-element",
                drop: function(event, ui) {
                    const type = ui.draggable.data("type");
                    addFormField(type);
                }
            });

            // Add form field
            function addFormField(type) {
                fieldCount++;
                const fieldId = 'field-' + fieldCount;
                let fieldHtml = '';
                
                switch(type) {
                    case 'text':
                        fieldHtml = `
                            <div class="form-field" id="${fieldId}" data-type="${type}">
                                <div class="field-actions">
                                    <button class="edit-field" title="Edit"><i>‚úèÔ∏è</i></button>
                                    <button class="delete-field" title="Delete"><i>üóëÔ∏è</i></button>
                                </div>
                                <label>Text Input ${fieldCount}</label>
                                <input type="text" placeholder="Enter text">
                            </div>
                        `;
                        break;
                    case 'textarea':
                        fieldHtml = `
                            <div class="form-field" id="${fieldId}" data-type="${type}">
                                <div class="field-actions">
                                    <button class="edit-field" title="Edit"><i>‚úèÔ∏è</i></button>
                                    <button class="delete-field" title="Delete"><i>üóëÔ∏è</i></button>
                                </div>
                                <label>Paragraph Text ${fieldCount}</label>
                                <textarea placeholder="Enter text" rows="3"></textarea>
                            </div>
                        `;
                        break;
                    case 'email':
                        fieldHtml = `
                            <div class="form-field" id="${fieldId}" data-type="${type}">
                                <div class="field-actions">
                                    <button class="edit-field" title="Edit"><i>‚úèÔ∏è</i></button>
                                    <button class="delete-field" title="Delete"><i>üóëÔ∏è</i></button>
                                </div>
                                <label>Email Address ${fieldCount}</label>
                                <input type="email" placeholder="Enter email">
                            </div>
                        `;
                        break;
                    case 'number':
                        fieldHtml = `
                            <div class="form-field" id="${fieldId}" data-type="${type}">
                                <div class="field-actions">
                                    <button class="edit-field" title="Edit"><i>‚úèÔ∏è</i></button>
                                    <button class="delete-field" title="Delete"><i>üóëÔ∏è</i></button>
                                </div>
                                <label>Number ${fieldCount}</label>
                                <input type="number" placeholder="Enter number">
                            </div>
                        `;
                        break;
                    case 'date':
                        fieldHtml = `
                            <div class="form-field" id="${fieldId}" data-type="${type}">
                                <div class="field-actions">
                                    <button class="edit-field" title="Edit"><i>‚úèÔ∏è</i></button>
                                    <button class="delete-field" title="Delete"><i>üóëÔ∏è</i></button>
                                </div>
                                <label>Date ${fieldCount}</label>
                                <input type="date">
                            </div>
                        `;
                        break;
                    case 'time':
                        fieldHtml = `
                            <div class="form-field" id="${fieldId}" data-type="${type}">
                                <div class="field-actions">
                                    <button class="edit-field" title="Edit"><i>‚úèÔ∏è</i></button>
                                    <button class="delete-field" title="Delete"><i>üóëÔ∏è</i></button>
                                </div>
                                <label>Time ${fieldCount}</label>
                                <input type="time">
                            </div>
                        `;
                        break;
                    case 'radio':
                        fieldHtml = `
                            <div class="form-field" id="${fieldId}" data-type="${type}">
                                <div class="field-actions">
                                    <button class="edit-field" title="Edit"><i>‚úèÔ∏è</i></button>
                                    <button class="delete-field" title="Delete"><i>üóëÔ∏è</i></button>
                                </div>
                                <label>Multiple Choice ${fieldCount}</label>
                                <div>
                                    <label><input type="radio" name="radio-${fieldCount}" value="option1"> Option 1</label>
                                </div>
                                <div>
                                    <label><input type="radio" name="radio-${fieldCount}" value="option2"> Option 2</label>
                                </div>
                                <div>
                                    <label><input type="radio" name="radio-${fieldCount}" value="option3"> Option 3</label>
                                </div>
                            </div>
                        `;
                        break;
                    case 'checkbox':
                        fieldHtml = `
                            <div class="form-field" id="${fieldId}" data-type="${type}">
                                <div class="field-actions">
                                    <button class="edit-field" title="Edit"><i>‚úèÔ∏è</i></button>
                                    <button class="delete-field" title="Delete"><i>üóëÔ∏è</i></button>
                                </div>
                                <label>Checkboxes ${fieldCount}</label>
                                <div>
                                    <label><input type="checkbox" value="option1"> Option 1</label>
                                </div>
                                <div>
                                    <label><input type="checkbox" value="option2"> Option 2</label>
                                </div>
                                <div>
                                    <label><input type="checkbox" value="option3"> Option 3</label>
                                </div>
                            </div>
                        `;
                        break;
                    case 'select':
                        fieldHtml = `
                            <div class="form-field" id="${fieldId}" data-type="${type}">
                                <div class="field-actions">
                                    <button class="edit-field" title="Edit"><i>‚úèÔ∏è</i></button>
                                    <button class="delete-field" title="Delete"><i>üóëÔ∏è</i></button>
                                </div>
                                <label>Dropdown ${fieldCount}</label>
                                <select>
                                    <option value="">Select an option</option>
                                    <option value="option1">Option 1</option>
                                    <option value="option2">Option 2</option>
                                    <option value="option3">Option 3</option>
                                </select>
                            </div>
                        `;
                        break;
                    case 'file':
                        fieldHtml = `
                            <div class="form-field" id="${fieldId}" data-type="${type}">
                                <div class="field-actions">
                                    <button class="edit-field" title="Edit"><i>‚úèÔ∏è</i></button>
                                    <button class="delete-field" title="Delete"><i>üóëÔ∏è</i></button>
                                </div>
                                <label>File Upload ${fieldCount}</label>
                                <input type="file">
                            </div>
                        `;
                        break;
                    case 'rating':
                        fieldHtml = `
                            <div class="form-field" id="${fieldId}" data-type="${type}">
                                <div class="field-actions">
                                    <button class="edit-field" title="Edit"><i>‚úèÔ∏è</i></button>
                                    <button class="delete-field" title="Delete"><i>üóëÔ∏è</i></button>
                                </div>
                                <label>Rating ${fieldCount}</label>
                                <div style="font-size: 24px;">
                                    <span style="cursor: pointer;">‚òÜ</span>
                                    <span style="cursor: pointer;">‚òÜ</span>
                                    <span style="cursor: pointer;">‚òÜ</span>
                                    <span style="cursor: pointer;">‚òÜ</span>
                                    <span style="cursor: pointer;">‚òÜ</span>
                                </div>
                            </div>
                        `;
                        break;
                    case 'signature':
                        fieldHtml = `
                            <div class="form-field" id="${fieldId}" data-type="${type}">
                                <div class="field-actions">
                                    <button class="edit-field" title="Edit"><i>‚úèÔ∏è</i></button>
                                    <button class="delete-field" title="Delete"><i>üóëÔ∏è</i></button>
                                </div>
                                <label>Signature ${fieldCount}</label>
                                <div style="height: 100px; border: 1px solid #ced4da; border-radius: 4px; background: white;"></div>
                                <button style="margin-top: 5px;">Clear</button>
                            </div>
                        `;
                        break;
                }

                $("#formArea").append(fieldHtml);
                formFields.push({
                    id: fieldId,
                    type: type,
                    label: $(fieldHtml).find('label').text()
                });
            }

            // Delete form field
            $(document).on('click', '.delete-field', function() {
                const fieldId = $(this).closest('.form-field').attr('id');
                $(this).closest('.form-field').remove();
                formFields = formFields.filter(field => field.id !== fieldId);
            });

            // Edit form field
            $(document).on('click', '.edit-field', function() {
                const field = $(this).closest('.form-field');
                const currentLabel = field.find('label').text();
                const newLabel = prompt("Edit field label:", currentLabel);
                if (newLabel !== null) {
                    field.find('label').text(newLabel);
                    
                    // Update in formFields array
                    const fieldId = field.attr('id');
                    const fieldIndex = formFields.findIndex(f => f.id === fieldId);
                    if (fieldIndex !== -1) {
                        formFields[fieldIndex].label = newLabel;
                    }
                }
            });

            // Save form
            $("#saveForm").click(function() {
                const formName = prompt("Enter a name for your form:");
                if (formName) {
                    const formId = 'form-' + Date.now();
                    const formConfig = {
                        id: formId,
                        name: formName,
                        fields: formFields,
                        html: $("#formArea").html(),
                        createdAt: new Date().toISOString()
                    };
                    
                    // Save to localStorage
                    let savedForms = JSON.parse(localStorage.getItem('savedForms'));
                    savedForms.push(formConfig);
                    localStorage.setItem('savedForms', JSON.stringify(savedForms));
                    
                    currentFormId = formId;
                    alert("Form saved successfully!");
                }
            });

            // Preview form
            $("#previewBtn").click(function() {
                $("#previewArea").html($("#formArea").html());
                $("#previewArea .field-actions").remove();
                
                // Add submit button to preview
                $("#previewArea").append(`
                    <button class="btn btn-primary" id="submitPreview">Submit Form</button>
                `);
                
                // Handle form submission from preview
                $(document).on('click', '#submitPreview', function() {
                    if (!currentFormId) {
                        alert("Please save the form before submitting.");
                        return;
                    }
                    
                    const formData = {};
                    $("#previewArea .form-field").each(function() {
                        const fieldId = $(this).attr('id');
                        const fieldType = $(this).data('type');
                        let value = '';
                        
                        if (fieldType === 'checkbox') {
                            value = $(this).find('input[type="checkbox"]:checked').map(function() {
                                return $(this).val();
                            }).get().join(', ');
                        } else if (fieldType === 'radio') {
                            value = $(this).find('input[type="radio"]:checked').val();
                        } else {
                            value = $(this).find('input, select, textarea').val();
                        }
                        
                        formData[fieldId] = {
                            type: fieldType,
                            label: $(this).find('label').text(),
                            value: value
                        };
                    });
                    
                    // Save submission
                    const submission = {
                        formId: currentFormId,
                        formName: "Form Submission",
                        data: formData,
                        submittedAt: new Date().toISOString()
                    };
                    
                    let submissions = JSON.parse(localStorage.getItem('formSubmissions'));
                    submissions.push(submission);
                    localStorage.setItem('formSubmissions', JSON.stringify(submissions));
                    
                    alert("Form submitted successfully! Data saved to dashboard.");
                });
            });

            // View dashboard
            $("#viewDashboard").click(function() {
                $(".main-container").hide();
                $("#dashboard").show();
                updateDashboard();
            });

            // Back to builder
            $("#backToBuilder").click(function() {
                $("#dashboard").hide();
                $(".main-container").show();
            });

            // Reset all data
            $("#resetAll").click(function() {
                if (confirm("Are you sure you want to reset all data? This cannot be undone.")) {
                    localStorage.setItem('savedForms', JSON.stringify([]));
                    localStorage.setItem('formSubmissions', JSON.stringify([]));
                    $("#formArea").empty();
                    formFields = [];
                    fieldCount = 0;
                    currentFormId = null;
                    alert("All data has been reset.");
                }
            });

            // Export all data
            $("#exportData").click(function() {
                const allData = {
                    savedForms: JSON.parse(localStorage.getItem('savedForms')),
                    submissions: JSON.parse(localStorage.getItem('formSubmissions'))
                };
                
                const dataStr = JSON.stringify(allData, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
                
                const exportName = 'form_builder_data_' + new Date().toISOString().slice(0,10) + '.json';
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportName);
                document.body.appendChild(linkElement);
                linkElement.click();
                document.body.removeChild(linkElement);
            });

            // Modal close
            $(".close").click(function() {
                $("#submissionModal").hide();
            });

            // Update dashboard
            function updateDashboard() {
                const savedForms = JSON.parse(localStorage.getItem('savedForms'));
                const submissions = JSON.parse(localStorage.getItem('formSubmissions'));
                
                // Display saved forms
                let formsHtml = '';
                if (savedForms.length > 0) {
                    savedForms.forEach(form => {
                        formsHtml += `
                            <div class="data-card">
                                <h3>${form.name}</h3>
                                <div class="timestamp">Created: ${new Date(form.createdAt).toLocaleString()}</div>
                                <button class="btn btn-secondary" onclick="loadForm('${form.id}')">Load</button>
                                <button class="btn btn-danger" onclick="deleteForm('${form.id}')">Delete</button>
                            </div>
                        `;
                    });
                } else {
                    formsHtml = '<p>No forms saved yet.</p>';
                }
                $("#savedFormsList").html(formsHtml);
                
                // Display submissions
                let submissionsHtml = '';
                if (submissions.length > 0) {
                    submissions.forEach((submission, index) => {
                        submissionsHtml += `
                            <div class="data-card">
                                <h3>${submission.formName}</h3>
                                <div class="timestamp">Submitted: ${new Date(submission.submittedAt).toLocaleString()}</div>
                                <button class="btn btn-secondary" onclick="viewSubmission(${index})">View</button>
                                <button class="btn btn-danger" onclick="deleteSubmission(${index})">Delete</button>
                            </div>
                        `;
                    });
                } else {
                    submissionsHtml = '<p>No submissions yet.</p>';
                }
                $("#submissionsList").html(submissionsHtml);
            }

            // Global functions for dashboard buttons
            window.loadForm = function(formId) {
                const savedForms = JSON.parse(localStorage.getItem('savedForms'));
                const form = savedForms.find(f => f.id === formId);
                
                if (form) {
                    $("#formArea").html(form.html);
                    formFields = form.fields;
                    fieldCount = formFields.length;
                    currentFormId = formId;
                    
                    $("#dashboard").hide();
                    $(".main-container").show();
                    alert(`Form "${form.name}" loaded successfully!`);
                }
            };

            window.deleteForm = function(formId) {
                if (confirm("Are you sure you want to delete this form?")) {
                    let savedForms = JSON.parse(localStorage.getItem('savedForms'));
                    savedForms = savedForms.filter(f => f.id !== formId);
                    localStorage.setItem('savedForms', JSON.stringify(savedForms));
                    
                    // Also delete related submissions
                    let submissions = JSON.parse(localStorage.getItem('formSubmissions'));
                    submissions = submissions.filter(s => s.formId !== formId);
                    localStorage.setItem('formSubmissions', JSON.stringify(submissions));
                    
                    updateDashboard();
                }
            };

            window.viewSubmission = function(index) {
                const submissions = JSON.parse(localStorage.getItem('formSubmissions'));
                const submission = submissions[index];
                
                let detailsHtml = `<h3>${submission.formName}</h3>`;
                detailsHtml += `<p>Submitted: ${new Date(submission.submittedAt).toLocaleString()}</p>`;
                detailsHtml += '<div class="submission-details">';
                
                for (const [fieldId, fieldData] of Object.entries(submission.data)) {
                    detailsHtml += `
                        <div class="data-item">
                            <strong>${fieldData.label}</strong> (${fieldData.type}): 
                            ${fieldData.value || 'N/A'}
                        </div>
                    `;
                }
                
                detailsHtml += '</div>';
                $("#submissionDetails").html(detailsHtml);
                $("#submissionModal").show();
            };

            window.deleteSubmission = function(index) {
                if (confirm("Are you sure you want to delete this submission?")) {
                    let submissions = JSON.parse(localStorage.getItem('formSubmissions'));
                    submissions.splice(index, 1);
                    localStorage.setItem('formSubmissions', JSON.stringify(submissions));
                    updateDashboard();
                }
            };
        });
    </script>
</body>
</html>